<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Rater</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- User Profile Section -->
        <div id="user-profile-section" class="user-profile-section">
            <h1>Weather Rater</h1>
            <p class="subtitle">Track and share your weather ratings with friends</p>

            <!-- Login Form -->
            <div id="login-form" class="auth-form" style="display: block;">
                <h2>Welcome Back</h2>
                <div class="profile-input">
                    <input type="text" id="login-username" placeholder="Username" maxlength="20">
                    <input type="password" id="login-password" placeholder="Password">
                    <button id="login-btn" class="save-btn">Log In</button>
                </div>
                <p class="auth-toggle">Don't have an account? <a href="#" id="show-signup">Sign up</a></p>
            </div>

            <!-- Sign Up Form -->
            <div id="signup-form" class="auth-form" style="display: none;">
                <h2>Create Account</h2>
                <div class="profile-input">
                    <input type="text" id="signup-username" placeholder="Choose a username" maxlength="20">
                    <input type="password" id="signup-password" placeholder="Choose a password" minlength="6">
                    <button id="signup-btn" class="save-btn">Create Account</button>
                </div>
                <p class="auth-toggle">Already have an account? <a href="#" id="show-login">Log in</a></p>
            </div>

            <!-- Incoming Friend Requests Notification -->
            <div id="friend-requests-notification" class="friend-requests-notification" style="display: none;">
                <h3>ðŸ”” Friend Requests</h3>
                <div id="incoming-requests-list"></div>
            </div>
        </div>

        <!-- Main App (hidden until username is set) -->
        <div id="main-app" class="main-app" style="display: none;">
            <div class="header">
                <h1>Weather Rater</h1>
                <div class="user-info">
                    <span id="current-user"></span>
                    <button id="change-user-btn" class="change-user-btn">Change User</button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="my-ratings">Rating</button>
                <button class="tab-btn" data-tab="friends-ratings">Friends</button>
            </div>

            <div id="message" class="message"></div>

            <!-- Tab Content: My Ratings -->
            <div id="my-ratings-tab" class="tab-content active">
                <!-- Overall Rating Section -->
                <div class="rating-section">
                    <h3>Overall Weather Rating</h3>
                    <div class="rating-buttons">
                        <button class="rating-btn" data-rating="1">1</button>
                        <button class="rating-btn" data-rating="2">2</button>
                        <button class="rating-btn" data-rating="3">3</button>
                        <button class="rating-btn" data-rating="4">4</button>
                        <button class="rating-btn" data-rating="5">5</button>
                        <button class="rating-btn" data-rating="6">6</button>
                        <button class="rating-btn" data-rating="7">7</button>
                        <button class="rating-btn" data-rating="8">8</button>
                        <button class="rating-btn" data-rating="9">9</button>
                        <button class="rating-btn" data-rating="10">10</button>
                    </div>

                    <div class="rating-labels">
                        <span class="label-left">Terrible</span>
                        <span class="label-right">Perfect</span>
                    </div>
                </div>

                <p class="subtitle">How would you rate today's weather?</p>

                <!-- Current Weather Display -->
                <div id="current-weather" class="current-weather">
                    <div class="weather-loading">Fetching weather data...</div>
                </div>

                <!-- Map Section -->
                <div class="map-section">
                    <h2>Rating Map</h2>
                    <p class="map-subtitle">Your weather ratings across locations</p>
                    <div id="map"></div>
                    <div id="stats" class="stats"></div>
                </div>

                <!-- Rating History Section -->
                <div class="history-section">
                    <h2>Your Rating History</h2>
                    <div id="rating-history" class="rating-history"></div>
                </div>
            </div>

            <!-- Tab Content: Friends' Ratings -->
            <div id="friends-ratings-tab" class="tab-content" style="display: none;">
                <!-- Friends List (Clickable) -->
                <div class="friends-section">
                    <div class="friends-header">
                        <div>
                            <h3>My Friends</h3>
                            <p class="section-subtitle">Click a friend's name to view their ratings</p>
                        </div>
                        <div class="friends-settings">
                            <button class="settings-btn" id="friends-settings-btn" aria-label="Settings">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z" stroke="currentColor" stroke-width="1.5"/>
                                    <path d="M16.25 10C16.25 10.625 16.6875 11.1875 17.3125 11.3125C17.5 11.375 17.6875 11.5 17.8125 11.625L18.125 12.0625C18.3125 12.3125 18.375 12.625 18.3125 12.9375C18.25 13.25 18.0625 13.5 17.75 13.6875L17.4375 13.875C16.875 14.1875 16.5625 14.8125 16.6875 15.4375C16.75 15.6875 16.6875 15.9375 16.5625 16.125L16.25 16.5625C16.0625 16.8125 15.75 16.9375 15.4375 16.9375C15.125 16.9375 14.8125 16.8125 14.5625 16.625L14.25 16.4375C13.6875 16.0625 12.9375 16.0625 12.375 16.4375C12.125 16.5625 11.875 16.625 11.625 16.5625C11.0625 16.4375 10.625 16 10.625 15.4375V15.0625C10.625 14.375 10.0625 13.8125 9.375 13.8125C8.6875 13.8125 8.125 14.375 8.125 15.0625V15.4375C8.125 16 7.6875 16.4375 7.125 16.5625C6.875 16.625 6.625 16.5625 6.375 16.4375C5.8125 16.0625 5.0625 16.0625 4.5 16.4375L4.1875 16.625C3.9375 16.8125 3.625 16.9375 3.3125 16.9375C3 16.9375 2.6875 16.8125 2.5 16.5625L2.1875 16.125C2.0625 15.9375 2 15.6875 2.0625 15.4375C2.1875 14.8125 1.875 14.1875 1.3125 13.875L1 13.6875C0.6875 13.5 0.5 13.25 0.4375 12.9375C0.375 12.625 0.4375 12.3125 0.625 12.0625L0.9375 11.625C1.0625 11.5 1.25 11.375 1.4375 11.3125C2.0625 11.1875 2.5 10.625 2.5 10C2.5 9.375 2.0625 8.8125 1.4375 8.6875C1.25 8.625 1.0625 8.5 0.9375 8.375L0.625 7.9375C0.4375 7.6875 0.375 7.375 0.4375 7.0625C0.5 6.75 0.6875 6.5 1 6.3125L1.3125 6.125C1.875 5.8125 2.1875 5.1875 2.0625 4.5625C2 4.3125 2.0625 4.0625 2.1875 3.875L2.5 3.4375C2.6875 3.1875 3 3.0625 3.3125 3.0625C3.625 3.0625 3.9375 3.1875 4.1875 3.375L4.5 3.5625C5.0625 3.9375 5.8125 3.9375 6.375 3.5625C6.625 3.4375 6.875 3.375 7.125 3.4375C7.6875 3.5625 8.125 4 8.125 4.5625V4.9375C8.125 5.625 8.6875 6.1875 9.375 6.1875C10.0625 6.1875 10.625 5.625 10.625 4.9375V4.5625C10.625 4 11.0625 3.5625 11.625 3.4375C11.875 3.375 12.125 3.4375 12.375 3.5625C12.9375 3.9375 13.6875 3.9375 14.25 3.5625L14.5625 3.375C14.8125 3.1875 15.125 3.0625 15.4375 3.0625C15.75 3.0625 16.0625 3.1875 16.25 3.4375L16.5625 3.875C16.6875 4.0625 16.75 4.3125 16.6875 4.5625C16.5625 5.1875 16.875 5.8125 17.4375 6.125L17.75 6.3125C18.0625 6.5 18.25 6.75 18.3125 7.0625C18.375 7.375 18.3125 7.6875 18.125 7.9375L17.8125 8.375C17.6875 8.5 17.5 8.625 17.3125 8.6875C16.6875 8.8125 16.25 9.375 16.25 10Z" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                            </button>
                            <div class="settings-dropdown" id="friends-settings-dropdown" style="display: none;">
                                <button class="settings-dropdown-item" id="manage-friends-btn">
                                    Manage Friends
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="friends-list" class="friends-list-clickable"></div>
                </div>

                <!-- Selected Friend's Map Section -->
                <div class="map-section" id="friend-map-section" style="display: none;">
                    <h2 id="selected-friend-name">Friend's Ratings</h2>
                    <p class="map-subtitle">Your friend's weather ratings across locations</p>
                    <div id="friends-map"></div>
                    <div id="friends-stats" class="stats"></div>

                    <!-- Friend's Rating History -->
                    <div class="history-section" style="margin-top: 30px;">
                        <h3>Rating History</h3>
                        <div id="friend-rating-history" class="rating-history"></div>
                    </div>
                </div>

                <!-- Incoming Friend Requests -->
                <div class="incoming-requests-section" id="incoming-requests-section" style="display: none;">
                    <h3>ðŸ“¬ Incoming Friend Requests</h3>
                    <div id="incoming-friend-requests" class="incoming-requests-list"></div>
                </div>

                <!-- Add Friend -->
                <div class="friend-add-section">
                    <h3>Add Friend</h3>
                    <div class="friend-add">
                        <input type="text" id="friend-username" placeholder="Enter friend's username" maxlength="20">
                        <button id="add-friend-btn" class="action-btn">Send Friend Request</button>
                    </div>
                </div>

                <!-- Sent Friend Requests -->
                <div class="sent-requests-section">
                    <h3>Sent Friend Requests</h3>
                    <p class="section-subtitle">Pending requests you've sent</p>
                    <div id="sent-requests-list" class="sent-requests-list">
                        <div class="no-requests">No pending friend requests</div>
                    </div>
                </div>

                <!-- Privacy Toggle -->
                <div class="social-section">
                    <div class="privacy-toggle">
                        <label class="toggle-label">
                            <input type="checkbox" id="share-ratings" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Share my ratings with friends</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase will be initialized in firebase-config.js
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // This will be replaced with your actual Firebase config
        // For now, using a demo config - see firebase-config.js for setup
        const firebaseConfig = {
            apiKey: "DEMO-KEY",
            authDomain: "weather-rater-demo.firebaseapp.com",
            projectId: "weather-rater-demo",
            storageBucket: "weather-rater-demo.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        // Check if a custom config exists
        if (window.customFirebaseConfig) {
            Object.assign(firebaseConfig, window.customFirebaseConfig);
        }

        try {
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.firebaseEnabled = true;
        } catch (error) {
            console.warn('Firebase not configured, using localStorage fallback');
            window.firebaseEnabled = false;
        }
    </script>

    <script src="firebase-config.js"></script>
    <script src="app.js"></script>
</body>
</html>
